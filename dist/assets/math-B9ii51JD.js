import{l as y}from"./utils-Cb6_lU3v.js";const s=document.getElementById("gameCanvas"),a=s.getContext("2d"),r=document.getElementById("feedback");s.width=800;s.height=250;const f=new Image,g=new Image,d=new Image,e={marioX:50,currentNumber:0,startNumber:0,targetNumber:null,operation:"",selectedNumber:null,imagesLoaded:!1,numbers:[0,1,2,3,4,5,6,7,8,9,10],numberPositions:{},box:{x:s.width-100,y:30,width:50,height:50,hit:!1,bounce:0,isPulsing:!0},coin:{x:0,y:0,width:30,height:30,show:!1,frames:0,maxFrames:30}};function N(){return typeof math>"u"?(console.error("Error: Math.js library is not globally loaded."),null):math}function k(){const n=a.canvas.width-50,o=a.canvas.height/2+20;a.beginPath(),a.moveTo(50,o),a.lineTo(n,o),a.strokeStyle="#000000",a.lineWidth=3,a.stroke();const i=(n-50)/(e.numbers.length-1);e.numbers.forEach((c,p)=>{const h=50+p*i;e.numberPositions[c]=h;let m="#000000",b=20;e.currentNumber===c&&(m="#f39c12",b=24),e.targetNumber!==null&&c===e.targetNumber&&(m="#2ecc71",b=28),e.selectedNumber!==null&&c===e.selectedNumber&&(m="#3498db",b=26),a.font=b+"px Arial",a.fillStyle=m,a.fillText(c.toString(),h-(c<10?5:8),o+30)})}function C(){if(!e.imagesLoaded||!f.complete)return;const t=a.canvas.height/2.2-30+Math.sin(Date.now()/200)*5;a.drawImage(f,e.marioX,t,50,65)}function v(){if(!e.imagesLoaded||!g.complete)return;const t=e.box.y+Math.sin(Date.now()/300)*5;a.drawImage(g,e.box.x,t,e.box.width,e.box.height),e.box.hit&&(a.fillStyle="rgba(255, 215, 0, 0.5)",a.fillRect(e.box.x-5,t-5,e.box.width+10,e.box.height+10))}function I(){if(!e.coin.show||!e.imagesLoaded||!d.complete)return;if(e.coin.frames++,e.coin.frames>e.coin.maxFrames){e.coin.show=!1;return}const t=e.coin.y-e.coin.frames*2;a.drawImage(d,e.coin.x,t,e.coin.width,e.coin.height)}const u=new Tone.PolySynth(Tone.Synth,{oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.05,release:.2}}).toDestination();function P(){u.triggerAttackRelease("C5","8n")}function S(){u.triggerAttackRelease("C4","16n",Tone.now(),1)}function A(){const t=Tone.now();u.triggerAttackRelease("G5","32n",t),u.triggerAttackRelease("C6","32n",t+.07)}function $(){u.triggerAttackRelease("E4","16n")}function M(){u.triggerAttackRelease("A4","8n")}function R(){Tone.context.state!=="running"&&Tone.start()}function l(t,n){const o=N();return o?o.randomInt(t,n+1):(console.error("getRandomNumber: Math.js library is not available. Returning 0."),0)}function E(){let t,n;e.startNumber=e.currentNumber;const o=l(0,1);e.startNumber===0?(t="+",n=l(1,Math.min(5,10-e.startNumber))):e.startNumber===10?(t="-",n=l(1,Math.min(5,e.startNumber))):(t=o===0?"+":"-",t==="+"?n=l(1,Math.min(5,10-e.startNumber)):n=l(1,Math.min(5,e.startNumber))),t==="+"?e.targetNumber=e.startNumber+n:e.targetNumber=e.startNumber-n,e.operation=t+n,e.selectedNumber=null,r.textContent=`Solve: ${e.startNumber} ${t} ${n} = ?`,r.className="feedback-box default",e.box.isPulsing=!1}function x(t){const n=e.currentNumber+t;if(n<0||n>10){r.textContent="You can't leave the number line!",r.className="feedback-box incorrect";return}if($(),e.currentNumber=n,e.marioX=e.numberPositions[e.currentNumber]-15,e.selectedNumber=e.currentNumber,e.targetNumber!==null){const o=e.operation[0],i=e.operation.substring(1);r.textContent=`Solve: ${e.startNumber} ${o} ${i} = ?`,r.className="feedback-box default"}}function X(){if(e.targetNumber===null){r.textContent="Click the ? box first!",r.className="feedback-box incorrect";return}if(e.selectedNumber===null){r.textContent="Use arrow keys to pick a number",r.className="feedback-box incorrect";return}const t=e.operation[0],n=parseInt(e.operation.substring(1));e.selectedNumber===e.targetNumber?(r.textContent=`Correct! ${e.startNumber} ${t} ${n} = ${e.targetNumber}`,r.className="feedback-box correct",P(),A(),L(),e.targetNumber=null,e.box.isPulsing=!0):(r.textContent=`Incorrect. Answer: ${e.startNumber} ${t} ${n} = ${e.targetNumber}`,r.className="feedback-box incorrect",S(),e.box.isPulsing=!0)}function L(){e.coin.x=e.marioX+5,e.coin.y=s.height/2-60,e.coin.show=!0,e.coin.frames=0}function T(){const n=[{img:f,src:"/images/mario.webp"},{img:g,src:"/images/box.webp"},{img:d,src:"/images/coin.webp"}].map(function(o){return new Promise(function(i){o.img.onload=function(){i()},o.img.onerror=function(){console.error("Error loading image:",o.src),i()},o.img.src=o.src})});return Promise.all(n).then(function(){e.imagesLoaded=!0})}function Y(){s.addEventListener("click",t=>{const n=s.getBoundingClientRect(),o=t.clientX-n.left,i=t.clientY-n.top;o>=e.box.x&&o<=e.box.x+e.box.width&&i>=e.box.y+e.box.bounce&&i<=e.box.y+e.box.height+e.box.bounce&&(e.box.hit=!0,M(),setTimeout(function(){e.box.hit=!1,E()},400))}),document.addEventListener("keydown",function(t){R(),t.key==="ArrowRight"?x(1):t.key==="ArrowLeft"?x(-1):t.key==="Enter"&&X()})}function w(){a.clearRect(0,0,s.width,s.height),k(),v(),C(),I(),requestAnimationFrame(w)}function B(){if(N()===null){r.textContent="Error: Math.js library not loaded. Please try again!",r.className="feedback-box incorrect";return}r.textContent="Loading game...",r.className="feedback-box loading-message",T().then(function(){Y();const n=(s.width-100)/(e.numbers.length-1);for(let o=0;o<e.numbers.length;o++){const i=e.numbers[o],c=50+o*n;e.numberPositions[i]=c}e.marioX=e.numberPositions[e.currentNumber]-15,r.textContent="Click the ? box to start!",r.className="feedback-box default",w()}).catch(function(t){r.textContent="Error loading game. Please try refreshing the page!",r.className="feedback-box incorrect",console.error("Game start error:",t)})}y();B();
